\chapter{slow-\/compiles}
\hypertarget{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b}{}\label{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b}\index{slow-\/compiles@{slow-\/compiles}}
\label{_top}%
 \hypertarget{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md593}{}\doxysection{\texorpdfstring{Why do my tests take so long to compile?}{Why do my tests take so long to compile?}}\label{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md593}
{\bfseries{Contents}}~\newline
 Short answer~\newline
 Long answer~\newline
 Practical example~\newline
 Using the static library Catch2\+With\+Main~\newline
 Other possible solutions~\newline


Several people have reported that test code written with Catch takes much longer to compile than they would expect. Why is that?

Catch is implemented entirely in headers. There is a little overhead due to this -\/ but not as much as you might think -\/ and you can minimise it simply by organising your test code as follows\+:\hypertarget{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md594}{}\doxysubsection{\texorpdfstring{Short answer}{Short answer}}\label{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md594}
Exactly one source file must {\ttfamily \#define} either {\ttfamily CATCH\+\_\+\+CONFIG\+\_\+\+MAIN} or {\ttfamily CATCH\+\_\+\+CONFIG\+\_\+\+RUNNER} before {\ttfamily \#include}-\/ing Catch. In this file {\itshape do not write any test cases}! In most cases that means this file will just contain two lines (the {\ttfamily \#define} and the {\ttfamily \#include}).\hypertarget{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md595}{}\doxysubsection{\texorpdfstring{Long answer}{Long answer}}\label{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md595}
Usually C++ code is split between a header file, containing declarations and prototypes, and an implementation file (.cpp) containing the definition, or implementation, code. Each implementation file, along with all the headers that it includes (and which those headers include, etc), is expanded into a single entity called a translation unit -\/ which is then passed to the compiler and compiled down to an object file.

But functions and methods can also be written inline in header files. The downside to this is that these definitions will then be compiled in {\itshape every} translation unit that includes the header.

Because Catch is implemented {\itshape entirely} in headers you might think that the whole of Catch must be compiled into every translation unit that uses it! Actually it\textquotesingle{}s not quite as bad as that. Catch mitigates this situation by effectively maintaining the traditional separation between the implementation code and declarations. Internally the implementation code is protected by {\ttfamily \#ifdef}s and is conditionally compiled into only one translation unit. This translation unit is that one that {\ttfamily \#define}s {\ttfamily CATCH\+\_\+\+CONFIG\+\_\+\+MAIN} or {\ttfamily CATCH\+\_\+\+CONFIG\+\_\+\+RUNNER}. Let\textquotesingle{}s call this the main source file.

As a result the main source file {\itshape does} compile the whole of Catch every time! So it makes sense to dedicate this file to {\itshape only} {\ttfamily \#define}-\/ing the identifier and {\ttfamily \#include}-\/ing Catch (and implementing the runner code, if you\textquotesingle{}re doing that). Keep all your test cases in other files. This way you won\textquotesingle{}t pay the recompilation cost for the whole of Catch.\hypertarget{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md596}{}\doxysubsection{\texorpdfstring{Practical example}{Practical example}}\label{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md596}
Assume you have the {\ttfamily Factorial} function from the \href{tutorial.md\#top}{\texttt{ tutorial}} in {\ttfamily factorial.\+cpp} (with forward declaration in {\ttfamily factorial.\+h}) and want to test it and keep the compile times down when adding new tests. Then you should have 2 files, {\ttfamily tests-\/main.\+cpp} and {\ttfamily tests-\/factorial.\+cpp}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ tests-\/main.cpp}}
\DoxyCodeLine{\textcolor{preprocessor}{\#define\ CATCH\_CONFIG\_MAIN}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ "{}catch.hpp"{}}}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ tests-\/factorial.cpp}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ "{}catch.hpp"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ "{}factorial.h"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{TEST\_CASE(\ \textcolor{stringliteral}{"{}Factorials\ are\ computed"{}},\ \textcolor{stringliteral}{"{}[factorial]"{}}\ )\ \{}
\DoxyCodeLine{\ \ \ \ REQUIRE(\ Factorial(1)\ ==\ 1\ );}
\DoxyCodeLine{\ \ \ \ REQUIRE(\ Factorial(2)\ ==\ 2\ );}
\DoxyCodeLine{\ \ \ \ REQUIRE(\ Factorial(3)\ ==\ 6\ );}
\DoxyCodeLine{\ \ \ \ REQUIRE(\ Factorial(10)\ ==\ 3628800\ );}
\DoxyCodeLine{\}}

\end{DoxyCode}


After compiling {\ttfamily tests-\/main.\+cpp} once, it is enough to link it with separately compiled {\ttfamily tests-\/factorial.\+cpp}. This means that adding more tests to {\ttfamily tests-\/factorial.\+cpp}, will not result in recompiling Catch\textquotesingle{}s main and the resulting compilation times will decrease substantially.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ g++\ tests-\/main.cpp\ -\/c}
\DoxyCodeLine{\$\ g++\ factorial.cpp\ -\/c}
\DoxyCodeLine{\$\ g++\ tests-\/main.o\ factorial.o\ tests-\/factorial.cpp\ -\/o\ tests\ \&\&\ ./tests\ -\/r\ compact}
\DoxyCodeLine{Passed\ 1\ test\ case\ with\ 4\ assertions.}

\end{DoxyCode}


Now, the next time we change the file {\ttfamily tests-\/factorial.\+cpp} (say we add {\ttfamily REQUIRE( Factorial(0) == 1)}), it is enough to recompile the tests instead of recompiling main as well\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ g++\ tests-\/main.o\ factorial.o\ tests-\/factorial.cpp\ -\/o\ tests\ \&\&\ ./tests\ -\/r\ compact}
\DoxyCodeLine{tests-\/factorial.cpp:11:\ failed:\ Factorial(0)\ ==\ 1\ for:\ 0\ ==\ 1}
\DoxyCodeLine{Failed\ 1\ test\ case,\ failed\ 1\ assertion.}

\end{DoxyCode}
\hypertarget{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md597}{}\doxysubsection{\texorpdfstring{Using the static library Catch2\+With\+Main}{Using the static library Catch2\+With\+Main}}\label{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md597}
Catch2 also provides a static library that implements the runner. Note that this support is experimental, due to interactions between Catch2 v2 implementation and C++ linking limitations.

As with the {\ttfamily Catch2} target, the {\ttfamily Catch2\+With\+Main} CMake target can be used either from a subdirectory, or from installed build.\hypertarget{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md598}{}\doxysubsubsection{\texorpdfstring{CMake}{CMake}}\label{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md598}

\begin{DoxyCode}{0}
\DoxyCodeLine{add\_executable(tests-\/factorial\ tests-\/factorial.cpp)}
\DoxyCodeLine{}
\DoxyCodeLine{target\_link\_libraries(tests-\/factorial\ Catch2::Catch2WithMain)}

\end{DoxyCode}
\hypertarget{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md599}{}\doxysubsubsection{\texorpdfstring{bazel}{bazel}}\label{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md599}

\begin{DoxyCode}{0}
\DoxyCodeLine{cc\_test(}
\DoxyCodeLine{\ \ \ \ name\ =\ \textcolor{stringliteral}{"{}hello\_world\_test"{}},}
\DoxyCodeLine{\ \ \ \ srcs\ =\ [}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}test/hello\_world\_test.cpp"{}},}
\DoxyCodeLine{\ \ \ \ ],}
\DoxyCodeLine{\ \ \ \ deps\ =\ [}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}lib\_hello\_world"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}@catch2//:catch2\_with\_main"{}},}
\DoxyCodeLine{\ \ \ \ ],}
\DoxyCodeLine{)}

\end{DoxyCode}
\hypertarget{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md600}{}\doxysubsection{\texorpdfstring{Other possible solutions}{Other possible solutions}}\label{md__2_users_2thibault_2kdrive_21-_p_r_o_j_e_c_t_s_2_p-42_2push__swap_2push__swap__visualizer_2bu4015168695e02d33f930038fb39ae19b_autotoc_md600}
You can also opt to sacrifice some features in order to speed-\/up Catch\textquotesingle{}s compilation times. For details see the \href{configuration.md\#other-toggles}{\texttt{ documentation on Catch\textquotesingle{}s compile-\/time configuration}}.

\DoxyHorRuler{0}


\href{Readme.md\#top}{\texttt{ Home}} 